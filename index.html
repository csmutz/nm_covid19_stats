<!DOCTYPE html>
<html lang='en-US'>
<head>
<title>COVID-19 in East Mountains</title>
<link rel="stylesheet" href="mvp.css">
</head>
<body>

<script src="code/highcharts.js"></script>
<script src="code/modules/data.js"></script>
<script src="code/modules/series-label.js"></script>
<script src="code/modules/exporting.js"></script>
<script src="code/modules/export-data.js"></script>
<script src="code/modules/accessibility.js"></script>

<table>
<tr><th>7-day Average Daily<br />New Cases/Million</th><th>Covidexitstrategy<br />Score</th><th>14-day Total<br />New Cases/100K</th><th>CDC<br />Risk Level</th><th>Likelyhood of contagious<br />person in gathering of 100</th></tr>
<tr><th id="count_7_container"><div id="count_7"></div></th><th id="exit_risk_container"><div id="exit_risk"></div></th><th id="count_14_container"><div id="count_14"></div></th><th id="cdc_risk_container"><div id="cdc_risk"></div></th>
<th id="gathering_container"><div id="gathering"></div></th></tr>
</table>


<script type="text/javascript">

var getJSON = function(url, callback) {
    var xhr = new XMLHttpRequest();
    xhr.open('GET', url, true);
    xhr.responseType = 'json';
    xhr.onload = function() {
      var status = xhr.status;
      if (status === 200) {
        callback(null, xhr.response);
      } else {
        callback(status, xhr.response);
      }
    };
    xhr.send();
};

getJSON('https://yoursite.com/covid19/14_day.json?' + Date.now(),
function(err, data) {
    //alert('Your query count: ' + data.query.count);
    document.getElementById("count_14").appendChild(document.createTextNode(data));

    document.getElementById("gathering").appendChild(document.createTextNode(Number.parseFloat(data*4/14).toFixed(1)));
    document.getElementById("gathering").appendChild(document.createTextNode('%'));

    if (data < 5) {
         document.getElementById("cdc_risk").appendChild(document.createTextNode("Lowest"));
         document.getElementById("cdc_risk_container").style.background = "blue";
         document.getElementById("count_14_container").style.background = "blue";
         document.getElementById("gathering_container").style.background = "blue";
    } else if (data < 20) {
         document.getElementById("cdc_risk").appendChild(document.createTextNode("Lower"));
         document.getElementById("cdc_risk_container").style.background = "green";
         document.getElementById("count_14_container").style.background = "green";
         document.getElementById("gathering_container").style.background = "green";
    } else if (data < 50) {
         document.getElementById("cdc_risk").appendChild(document.createTextNode("Moderate"));
         document.getElementById("cdc_risk_container").style.background = "yellow";
         document.getElementById("count_14_container").style.background = "yellow";
         document.getElementById("gathering_container").style.background = "yellow";
    } else if (data < 200) {
         document.getElementById("cdc_risk").appendChild(document.createTextNode("Higher"));
         document.getElementById("cdc_risk_container").style.background = "orange";
         document.getElementById("count_14_container").style.background = "orange";
         document.getElementById("gathering_container").style.background = "orange";
    } else {
         document.getElementById("cdc_risk").appendChild(document.createTextNode("Highest"));
         document.getElementById("cdc_risk_container").style.background = "red";
         document.getElementById("count_14_container").style.background = "red";
         document.getElementById("gathering_container").style.background = "red";
    }
     
});

getJSON('https://yoursite.com/covid19/7_day.json?' + Date.now(),
function(err, data) {
    //alert('Your query count: ' + data.query.count);
    document.getElementById("count_7").appendChild(document.createTextNode(data));
    if (data < 40) {
         document.getElementById("exit_risk").appendChild(document.createTextNode("Trending Better"));
         document.getElementById("exit_risk_container").style.background = "green";
         document.getElementById("count_7_container").style.background = "green";
    } else if (data < 80) {
         document.getElementById("exit_risk").appendChild(document.createTextNode("Caution Warranted"));
         document.getElementById("exit_risk_container").style.background = "yellow";
         document.getElementById("count_7_container").style.background = "yellow";
    } else if (data < 150) {
         document.getElementById("exit_risk").appendChild(document.createTextNode("Trending Poorly"));
         document.getElementById("exit_risk_container").style.background = "red";
         document.getElementById("count_7_container").style.background = "red";
    } else  {
         document.getElementById("exit_risk").appendChild(document.createTextNode("Uncontrolled Spread"));
         document.getElementById("exit_risk_container").style.background = "darkred";
         document.getElementById("count_7_container").style.background = "darkred";
    }



});


</script>



<figure class="highcharts-figure">
    <div id="container_delta"></div>
</figure>

<figure class="highcharts-figure">
    <div id="container"></div>
</figure>
<!--
<figure class="highcharts-figure">
    <div id="container_delta_100k"></div>
</figure>
-->

<figure class="highcharts-figure">
    <div id="container_100k"></div>
</figure>


<script type="text/javascript">
    window.addEventListener('DOMContentLoaded', function (event) {


Highcharts.chart('container_delta', {
    chart: {
        type: 'column'
    },
    title: {
        text: 'New COVID-19 Cases in East Mountains'
    },
    data: {
        csvURL: 'https://yoursite.com/covid19/covid_delta.csv?' + Date.now(),
        beforeParse: function (csv) {
            return csv.replace(/\n\n/g, '\n');
        }
    },

//    xAxis: {
//        categories: ['Apples', 'Oranges', 'Pears', 'Grapes', 'Bananas']
//    },
    xAxis: {
        tickInterval: 7 * 24 * 3600 * 1000, // one week
        tickWidth: 0,
        gridLineWidth: 1,
        labels: {
            align: 'center',
            x: 3,
            y: 10
        }
    },

    yAxis: {
//        min: 0,
        title: {
            text: 'New COVID-19 Cases'
        },
        stackLabels: {
            enabled: true,
            style: {
                fontWeight: 'bold',
                color: ( // theme
                    Highcharts.defaultOptions.title.style &&
                    Highcharts.defaultOptions.title.style.color
                ) || 'gray'
            }
        }
    },
/*
    legend: {
        align: 'left',
        x: -30,
        verticalAlign: 'top',
        y: 25,
        floating: true,
        backgroundColor:
            Highcharts.defaultOptions.legend.backgroundColor || 'white',
        borderColor: '#CCC',
        borderWidth: 1,
        shadow: false
    },
*/  
    legend: {
        align: 'left',
        verticalAlign: 'top',
        borderWidth: 0
    },
    tooltip: {
//        headerFormat: '<b>foobar</b><br/>',
        headerFormat: '<b>{point.x:%A, %b %e, %Y}</b><br/>',
//        headerFormat: '<b>{Highcharts.dateFormat('%A, %b %e, %Y', point.x)}</b><br/>',
        pointFormat: '{series.name}: {point.y}<br/>Total: {point.stackTotal}'
    },
    plotOptions: {
        column: {
            stacking: 'normal',
            dataLabels: {
                enabled: true
            }
        }
    }
});

/*
Highcharts.chart('container_delta_100k', {
    chart: {
        type: 'column'
    },
    title: {
        text: 'New COVID-19 Cases in East Mountains per 100k population'
    },
    data: {
        csvURL: 'https://yoursite.com/covid19/covid_delta_100k.csv?' + Date.now(),
        beforeParse: function (csv) {
            return csv.replace(/\n\n/g, '\n');
        }
    },

//    xAxis: {
//        categories: ['Apples', 'Oranges', 'Pears', 'Grapes', 'Bananas']
//    },
    xAxis: {
        tickInterval: 7 * 24 * 3600 * 1000, // one week
        tickWidth: 0,
        gridLineWidth: 1,
        labels: {
            align: 'center',
            x: 3,
            y: 10
        }
    },

    yAxis: {
//        min: 0,
        title: {
            text: 'New COVID-19 Cases per 100k'
        },
        stackLabels: {
            enabled: true,
            style: {
                fontWeight: 'bold',
                color: ( // theme
                    Highcharts.defaultOptions.title.style &&
                    Highcharts.defaultOptions.title.style.color
                ) || 'gray'
            }
        }
    },
    legend: {
        align: 'left',
        verticalAlign: 'top',
        borderWidth: 0
    },
    tooltip: {
//        headerFormat: '<b>foobar</b><br/>',
        headerFormat: '<b>{point.x:%A, %b %e, %Y}</b><br/>',
//        headerFormat: '<b>{Highcharts.dateFormat('%A, %b %e, %Y', point.x)}</b><br/>',
        pointFormat: '{series.name}: {point.y}<br/>Total: {point.stackTotal}'
    },
    plotOptions: {
        column: {
            stacking: 'normal',
            dataLabels: {
                enabled: true
            }
        }
    }
});
*/


Highcharts.chart('container', {

    chart: {
        scrollablePlotArea: {
            minWidth: 700
        }
    },

    data: {
        csvURL: 'https://yoursite.com/covid19/covid.csv?' + Date.now(),
        beforeParse: function (csv) {
            return csv.replace(/\n\n/g, '\n');
        }
    },

    title: {
        text: 'Total COVID-19 Cases in East Mountains'
    },

//    subtitle: {
//        text: 'Source: New Mexico Department of Health'
//    },

    xAxis: {
        tickInterval: 7 * 24 * 3600 * 1000, // one week
        tickWidth: 0,
        gridLineWidth: 1,
        labels: {
            align: 'center',
            x: 3,
            y: 10
        }
    },

    yAxis: [{ // left y axis
        title: {
            text: 'Total COVID-19 Cases' 
        },
        labels: {
            align: 'right',
            x: -13,
            y: 16,
	    //offset: 20,
            format: '{value:.,0f}'
        },
        showFirstLabel: false
    }
/*
,       
        { // right y axis
        linkedTo: 0,
        gridLineWidth: 0,
        opposite: true,
        title: {
            text: null
        },
        labels: {
            align: 'right',
            x: 13,
            y: 16,
            format: '{value:.,0f}'
        },
        showFirstLabel: false
    }
*/
    ],

    legend: {
        align: 'left',
        verticalAlign: 'top',
        borderWidth: 0
    },

    tooltip: {
        shared: true,
        crosshairs: true
    },

    plotOptions: {
        series: {
            cursor: 'pointer',
            point: {
                events: {
                    click: function (e) {
                        hs.htmlExpand(null, {
                            pageOrigin: {
                                x: e.pageX || e.clientX,
                                y: e.pageY || e.clientY
                            },
                            headingText: this.series.name,
                            maincontentText: Highcharts.dateFormat('%A, %b %e, %Y', this.x) + ':<br/> ' +
                                this.y + ' sessions',
                            width: 200
                        });
                    }
                }
            },
            marker: {
                lineWidth: 1
            }
        }
    }
});


Highcharts.chart('container_100k', {

    chart: {
        scrollablePlotArea: {
            minWidth: 700
        }
    },

    data: {
        csvURL: 'https://yoursite.com/covid19/covid_100k.csv?' + Date.now(),
        beforeParse: function (csv) {
            return csv.replace(/\n\n/g, '\n');
        }
    },

    title: {
        text: 'Total COVID-19 Cases in East Mountains per 100k population'
    },

//    subtitle: {
//        text: 'Source: New Mexico Department of Health'
//    },

    xAxis: {
        tickInterval: 7 * 24 * 3600 * 1000, // one week
        tickWidth: 0,
        gridLineWidth: 1,
        labels: {
            align: 'center',
            x: 3,
            y: 10
        }
    },

    yAxis: [{ // left y axis
        title: {
            text: 'Total COVID-19 Cases per 100k'
        },
        labels: {
            align: 'right',
            x: -13,
            y: 16,
            //offset: 20,
            format: '{value:.,0f}'
        },
        showFirstLabel: false
    }
/*
,
        { // right y axis
        linkedTo: 0,
        gridLineWidth: 0,
        opposite: true,
        title: {
            text: null
        },
        labels: {
            align: 'right',
            x: 13,
            y: 16,
            format: '{value:.,0f}'
        },
        showFirstLabel: false
    }
*/
    ],

    legend: {
        align: 'left',
        verticalAlign: 'top',
        borderWidth: 0
    },

    tooltip: {
        shared: true,
        crosshairs: true
    },

    plotOptions: {
        series: {
            cursor: 'pointer',
            point: {
                events: {
                    click: function (e) {
                        hs.htmlExpand(null, {
                            pageOrigin: {
                                x: e.pageX || e.clientX,
                                y: e.pageY || e.clientY
                            },
                            headingText: this.series.name,
                            maincontentText: Highcharts.dateFormat('%A, %b %e, %Y', this.x) + ':<br/> ' +
                                this.y + ' sessions',
                            width: 200
                        });
                    }
                }
            },
            marker: {
                lineWidth: 1
            }
        }
    }
});


    });
</script>

<table>
<tr><th>Zip</th><th>Name</th><th>Population</th><th>Median Income</th></tr>
<tr><td>87008</td><td>Cedar Crest</td><td>2600</td><td>$75k</td></tr>
<tr><td>87015</td><td>Edgewood</td><td>13100</td><td>$63k</td></tr>
<tr><td>87016</td><td>Estancia</td><td>3700</td><td>$33k</td></tr>
<tr><td>87032</td><td>McIntosh</td><td>300</td><td>-</td></tr>
<tr><td>87035</td><td>Moriary</td><td>7300</td><td>$39k</td></tr>
<tr><td>87047</td><td>Sandia Park</td><td>4900</td><td>$72k</td></tr>
<tr><td>87056</td><td>Stanley</td><td>1000</td><td>$54k</td></tr>
<tr><td>87059</td><td>Tijeras</td><td>9600</td><td>$68k</td></tr>
</table>

<p>COVID-19 Data source: <a href="https://cv.nmhealth.org/">New Mexico Dept of Health</a><br />
Zip Code Data Source: <a href="https://www.zipdatamaps.com/">ZipDataMaps.com</a></p>

<p>Data from previous data is pulled every morning from NM Dept of Health website. "Total" counts are counts of confirmed COVID-19 since start of pandemic. "New" cases are simply daily changes in count. On some days, the total count drops, resulting in negative new cases reported. The cause of these drops is not known to the author of this site.</p>

<p>Score based on <a href="https://www.covidexitstrategy.org/definitions-and-criteria">Covidexitstrategy Criteria</a>. Risk level based on <a href="https://www.cdc.gov/coronavirus/2019-ncov/community/schools-childcare/indicators.html#thresholds">CDC thresholds for schools</a>. The "likelyhood of contagious person in gathering of 100" is similar to <a href="https://covid19risk.biosci.gatech.edu">Georgia Tech Event Risk Asessment Tool</a> using ascertainment bias (number of cases per each positive test) of 4 and period of contagiousness of 10 days. All of these metrics are based solely on current local transmission rates combining all listed zip codes. Other metrics like test positivity rate are not represented because this data is not available at zip code level.</p>

</body>
</html>

